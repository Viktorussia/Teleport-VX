#!/usr/bin/env ash
set -e

ROOT="$HOME/teleport-vx"

# UI Menu launcher
if [ "$1" = "menu" ] || [ "$1" = "ui" ]; then
    sh "$ROOT/ui/menu.sh"
    exit 0
fi

case "$1" in
    status)
        echo "Teleport VX b
 Neon Aurora"
        LOCALTIME=$(TZ=GMT-10 date "+%Y-%m-%d %H:%M:%S")
        printf "[OK] Local Time (Vladivostok): %s\n" "$LOCALTIME"
        printf "[OK] Kernel: active (ash/busybox)\n"

        MEM_TOTAL=$(grep MemTotal /proc/meminfo | awk '{print $2}')
        MEM_AVAIL=$(grep MemAvailable /proc/meminfo | awk '{print $2}')
        MEM_USED=$((MEM_TOTAL - MEM_AVAIL))
        printf "[OK] Memory: %s used / %s kB\n" "$MEM_USED" "$MEM_TOTAL"

        LOAD=$(uptime | awk -F'load average: ' '{print $2}')
        printf "[OK] CPU Load: %s\n" "$LOAD"

        UP=$(uptime | awk -F'up ' '{print $2}' | awk -F',' '{print $1}')
        printf "[OK] Uptime: %s\n" "$UP"
        ;;

    version)
        . "$ROOT/config/system.cfg"
        echo "$VX_VERSION ($VX_CODENAME) b
 $VX_BUILD_DATE"
        ;;

    doctor)
        sh "$ROOT/tools/doctor.sh"
        ;;

    net)
        shift
        sh "$ROOT/core/net.sh" "$@"
        ;;

    ui)
        sh "$ROOT/ui/menu.sh"
        ;;

    ""|help|-h|--help)
        echo "Usage: vx [status|version|doctor|net|menu]"
        ;;

    *)
        echo "Unknown command: $1"
        echo "Try: vx status"
        exit 1
        ;;
esac
